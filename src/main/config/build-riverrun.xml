<?xml version="1.0"?>
<!--
  - DSpace build file
  -
  - Local build tasks for RiverRun
  -
  - ant -f build-riverrun.xml [target]
  -->

<project name="RiverRun" default="help">

    <!-- ============================================================= -->
    <!-- Description                                                   -->
    <!-- ============================================================= -->

    <description>
======== DSpace platform build file: Local tasks for 'RiverRun' ========

Common usage:

  Load registry with additional DC elements and metadata schemas
    % ant load_registries

========================================================================
  </description>

    <!-- ============================================================= -->
    <!-- Will be using various environment variables                   -->
    <!-- ============================================================= -->

    <property environment="env" />


    <!-- ============================================================= -->
    <!-- Build parameters that are likely to need tweaking             -->
    <!-- ============================================================= -->

    <!-- Default configuration to use.  This may be overridden. -->
    <property name="config" value="config/dspace.cfg" />

    <!-- Give user a chance to override without editing this file 
       (and without typing -D each time s/he compiles it) -->
    <property file="${user.home}/.dspace.properties" />

    <!-- First, set the dspace.dir property so it can be
       interpolated when loading the config file.
       This crudely mimics the way ConfigurationManager interpolates properties.
       Note that it ONLY works for directories that interpolate ${dspace.dir}
       but that _should_ cover all cases used in this build configuration.
    -->
    <loadproperties srcFile="${config}">
        <filterchain>
            <linecontainsregexp>
                <regexp pattern="^\s*dspace\.dir\s+" />
            </linecontainsregexp>
        </filterchain>
    </loadproperties>

    <!-- Load the configuration -->
    <property file="${config}" />

    <!-- Timestamp date used when creating backup directories -->
    <tstamp>
        <format property="build.date" pattern="yyyyMMdd-HHmmss" />
    </tstamp>


    <!-- ============================================================= -->
    <!-- The DSpace class path for executing installation targets      -->
    <!-- ============================================================= -->

    <!-- We will include the environment CLASSPATH -->
    <path id="class.path">
        <pathelement path="${env.CLASSPATH}" />
        <fileset dir="lib">
            <include name="**/*.jar" />
        </fileset>
    </path>


    <!-- ============================================================= -->
    <!-- Print some useful help text                                  -->
    <!-- ============================================================= -->
    <target name="help">

        <echo message="" />
        <echo message="DSpace configuration file: RiverRun tasks" />
        <echo message="-----------------------------------------" />
        <echo message="" />
        <echo message="Available targets are:" />
        <echo message="" />
        <echo message="load_registries  --> Load custom metadata registries into the database" />
        <echo message="" />
    </target>


    <!-- ==================================================================== -->
    <!-- Load custom metadata schemas & elements registries into the database -->
    <!-- ==================================================================== -->

    <!-- Loads additions to Dublin Core type registries, and additional schemas, elements -->
    <target name="load_registries" description="Load initial contents of registries">
        <java classname="org.dspace.administer.MetadataImporter" classpathref="class.path" fork="yes" failonerror="yes">
            <sysproperty key="log4j.configuration" value="file:config/log4j-console.properties" />
            <sysproperty key="dspace.log.init.disable" value="true" />
            <sysproperty key="dspace.configuration" value="${config}" />
            <arg line="-f '${dspace.dir}/config/registries/riverrun-metadata.xml'" />
        </java>
    </target>

</project>
